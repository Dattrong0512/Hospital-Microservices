version: '3.8'

services:
  # Dịch vụ NotificationService
  notificationservice:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: notification_service_app
    ports:
      - "8088:80"
    environment:
      # Cấu hình môi trường ASP.NET Core
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: "http://+:80"

      # Cấu hình kết nối MongoDB
      MongoDBSettings__ConnectionString: "mongodb+srv://doadmin:NfO605M3o87yw1V2@notification-mongo-256fe619.mongo.ondigitalocean.com/admin?retryWrites=true&w=majority"
      MongoDBSettings__DatabaseName: "admin"
      MongoDBSettings__CollectionName: "notifications"

      # Cấu hình kết nối RabbitMQ 
      RabbitMQ__AmqpConnectionString: "amqps://errymwix:JCnl3C8qXN32qdFwK7B9hM-Dfn9SLrNb@armadillo.rmq.cloudamqp.com/errymwix"
      "QueueName": "appointment_queue"

    depends_on:
      - mongodb
      - rabbitmq

  # Dịch vụ MongoDB
  mongodb:
    image: mongo:latest
    container_name: mongodb_server
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db 

  # Dịch vụ RabbitMQ
  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: rabbitmq_server
    ports:
      - "5672:5672"
      - "15672:15672"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq

  rabbitmqcloudlistener:
    build:
      context: ./RabbitMQCloudListener
      dockerfile: Dockerfile
    container_name: rabbitmq_cloud_listener
    depends_on:
      - rabbitmq
      - mongodb
    environment:
      SendGrid__ApiKey: "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"
      SendGrid__SenderEmail: "kantruong11@gmail.com"
      SendGrid__SenderName: "ABC Hospital App"
    restart: unless-stopped

volumes:
  mongodb_data:
  rabbitmq_data: